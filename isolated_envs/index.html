
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../slurm-intro/">
      
      
        <link rel="next" href="../jupyter/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Isolated Environments - UPPMAX for Deep Learning</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Lato";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#use-isolated-environments" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="UPPMAX for Deep Learning" class="md-header__button md-logo" aria-label="UPPMAX for Deep Learning" data-md-component="logo">
      
  <img src="../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            UPPMAX for Deep Learning
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Isolated Environments
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../intro/" class="md-tabs__link">
          
  
  
  Course content

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="UPPMAX for Deep Learning" class="md-nav__button md-logo" aria-label="UPPMAX for Deep Learning" data-md-component="logo">
      
  <img src="../assets/logo.svg" alt="logo">

    </a>
    UPPMAX for Deep Learning
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Course content
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Course content
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Intro
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hardware_snowy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hardware
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../slurm-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Slurm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Isolated Environments
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Isolated Environments
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#isolated-environments" class="md-nav__link">
    <span class="md-ellipsis">
      Isolated environments
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Isolated environments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-happens-at-activation" class="md-nav__link">
    <span class="md-ellipsis">
      What happens at activation?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#virtual-environment-venv-virtualenv" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual environment - venv &amp; virtualenv
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Virtual environment - venv &amp; virtualenv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#typical-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Typical workflow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conda" class="md-nav__link">
    <span class="md-ellipsis">
      Conda
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conda">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#typical-workflow_1" class="md-nav__link">
    <span class="md-ellipsis">
      Typical workflow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-from-file" class="md-nav__link">
    <span class="md-ellipsis">
      Install from file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Install from file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#venv" class="md-nav__link">
    <span class="md-ellipsis">
      venv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conda_1" class="md-nav__link">
    <span class="md-ellipsis">
      conda
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Exercises
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jupyter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jupyter Notebooks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../VSCode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VS Code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DL_exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DL Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../profiling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Profling
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#isolated-environments" class="md-nav__link">
    <span class="md-ellipsis">
      Isolated environments
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Isolated environments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-happens-at-activation" class="md-nav__link">
    <span class="md-ellipsis">
      What happens at activation?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#virtual-environment-venv-virtualenv" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual environment - venv &amp; virtualenv
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Virtual environment - venv &amp; virtualenv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#typical-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Typical workflow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conda" class="md-nav__link">
    <span class="md-ellipsis">
      Conda
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conda">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#typical-workflow_1" class="md-nav__link">
    <span class="md-ellipsis">
      Typical workflow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-from-file" class="md-nav__link">
    <span class="md-ellipsis">
      Install from file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Install from file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#venv" class="md-nav__link">
    <span class="md-ellipsis">
      venv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conda_1" class="md-nav__link">
    <span class="md-ellipsis">
      conda
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Exercises
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="use-isolated-environments">Use isolated environments<a class="headerlink" href="#use-isolated-environments" title="Anchor link to this section for reference">&para;</a></h1>
<h2 id="isolated-environments">Isolated environments<a class="headerlink" href="#isolated-environments" title="Anchor link to this section for reference">&para;</a></h2>
<ul>
<li>As an example, maybe you have been using TensorFlow 1.x.x for your project and <ul>
<li>now you need to install a package that requires TensorFlow 2.x.x </li>
<li>but you will still be needing the old version of TensorFlow for another package, for instance. </li>
</ul>
</li>
<li>
<p>This is easily solved with isolated environments.</p>
</li>
<li>
<p>Another example is when a reviewer want you to remake a figure. </p>
<ul>
<li>You have already started to use a newer Python version or newer packages and </li>
<li>realise that your earlier script does not work anymore. </li>
</ul>
</li>
<li>Having freezed the environment would have solved you from this issue!</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Isolated/virtual environments solve a couple of problems:</p>
<ul>
<li>You can install specific, also older, package versions into them.</li>
<li>You can create one for each project and no problem if the two projects require different versions.</li>
<li>You can remove the environment and create a new one, if not needed or with errors.</li>
<li>Good for reproducibility!</li>
</ul>
</div>
<ul>
<li>Isolated environments let you create separate workspaces for different versions of Python and/or different versions of packages. </li>
<li>You can activate and deactivate them one at a time, and work as if the other workspace does not exist.</li>
</ul>
<p><strong>The tools</strong></p>
<ul>
<li>Python's built-in <code>venv</code> module: uses pip       </li>
<li><code>virtualenv</code> (can be installed): uses pip   </li>
<li><code>conda</code>/<code>forge</code>: uses <code>conda</code>/<code>mamba</code>     </li>
</ul>
<h3 id="what-happens-at-activation">What happens at activation?<a class="headerlink" href="#what-happens-at-activation" title="Anchor link to this section for reference">&para;</a></h3>
<ul>
<li>Python version is defined by the environment.<ul>
<li>Check with <code>which python</code>, should show at path to the environment.</li>
<li>In conda you can define python version as well</li>
<li>Since <code>venv</code> is part of Python you will get the python version used when running the <code>venv</code> command.</li>
</ul>
</li>
<li>Packages are defined by the environent.<ul>
<li>Check with <code>pip list</code></li>
<li>Conda can only see what you installed for it.</li>
<li>venv and virtualenv also see other packages if you allowed for that when creating the environment (<code>--system-site-packages</code>). </li>
</ul>
</li>
<li>You can work in a Python shell or IDE (coming session)</li>
<li>You can run scripts dependent on packages now instaleld in your environment.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li>Try with <code>venv</code> first</li>
<li>
<p>If very troublesome, try with <code>conda</code></p>
</li>
<li>
<p>To use self-installed Python packages in a batch script, you also need to load the above mentioned modules and activate the environment. An example of this will follow later in the course. </p>
</li>
<li>To see which Python packages you, yourself, have installed, you can use <code>pip list --user</code> while the environment you have installed the packages in is active. To see all packages, use <code>pip list</code>. </li>
</ul>
</div>
<h2 id="virtual-environment-venv-virtualenv">Virtual environment - venv &amp; virtualenv<a class="headerlink" href="#virtual-environment-venv-virtualenv" title="Anchor link to this section for reference">&para;</a></h2>
<p>With this tool you can download and install with <code>pip</code> from the <a href="https://pypi.org/">PyPI repository</a></p>
<details>
<summary>venv vs. virtualenv</summary>
<ul>
<li>These are almost completely interchangeable</li>
<li>The difference being that <strong>virtualenv supports older python versions</strong> and has a few more minor unique features, while <strong>venv is in the standard library</strong>.</li>
<li>Step 1:<ul>
<li>Virtualenv: <code>virtualenv --system-site-packages Example</code></li>
<li>venv: <code>python -m venv --system-site-packages Example2</code></li>
</ul>
</li>
<li>Next steps are identical and involves "activating" and <code>pip installs</code></li>
<li>We recommend <code>venv</code> in the course. Then we are just needing the Python module itself!</li>
</ul>
</details>
<h3 id="typical-workflow">Typical workflow<a class="headerlink" href="#typical-workflow" title="Anchor link to this section for reference">&para;</a></h3>
<ol>
<li>
<p>Start from a Python version you would like to use (load the module): </p>
<ul>
<li>This step are different at different clusters since the naming is different</li>
</ul>
</li>
<li>
<p>Load the Python module you will be using, as well as any site-installed package modules (requires the <code>--system-site-packages</code> option later)</p>
<ul>
<li><code>module load &lt;python module&gt;</code></li>
</ul>
</li>
</ol>
<p>The next points will be the same for all clusters</p>
<ol>
<li>
<p>Create the isolated environment with something like <code>python -m venv &lt;name-of-environment&gt;</code> </p>
<ul>
<li>use the <code>--system-site-packages</code> to include all "non-base" packages</li>
<li>include the full path in the name if you want the environment to be stored other than in the "present working directory".</li>
</ul>
</li>
<li>
<p>Activate the environment with <code>source &lt;path to virtual environment&gt;/bin activate</code></p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li><code>source</code> can most often be replaced by <code>.</code>, like in <code>. Example/bin/activate</code>. Note the important <space> after <code>.</code></li>
<li>For clarity we use the <code>source</code> style here.</li>
</ul>
</div>
<ol>
<li>
<p>Install (or update) the environment with the packages you need with the <code>pip install</code> command</p>
<ul>
<li>Note that <code>--user</code> must be omitted: else the package will be installed in the global user folder.</li>
<li>The <code>--no-cache-dir"</code> option is required to avoid it from reusing earlier installations from the same user in a different environment. The <code>--no-build-isolation</code> is to make sure that it uses the loaded modules from the module system when building any Cython libraries.</li>
</ul>
</li>
<li>
<p>Work in the isolated environment</p>
</li>
<li>When activated you can always continue to add packages!</li>
<li>Deactivate the environment after use with <code>deactivate</code></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To save space, you should load any other Python modules you will need that are system installed before installing your own packages! Remember to choose ones that are compatible with the Python version you picked! 
     <code>--system-site-packages</code> includes the packages already installed in the loaded python module.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">$ </span>module<span class="w"> </span>load<span class="w"> </span>python/3.11.5<span class="w"> </span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>--system-site-packages<span class="w"> </span>Example_env
</code></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Draw-backs</p>
<ul>
<li>Only works for Python environments</li>
<li>Only works with Python versions already installed</li>
</ul>
</div>
<details>
<summary>Example</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="go">ml python/3.11.5 </span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="go">which python</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="go">python -V</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="go">cd /proj/uppmax2025-3-5/private/&lt;username&gt;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="go">python -m venv torch_env</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="go">source activate  torch_env</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="go">pip install torch torchvision </span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="go">python</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
</code></pre></div>
</details>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>You can use "pip list" on the command line (after loading the python module) to see which packages are available and which versions. </li>
<li>Some packaegs may be inhereted from the moduels yopu have loaded</li>
<li>You can do <code>pip list --local</code> to see what is installed by you in the environment.</li>
<li>Some IDE:s like Spyder may only find those "local" packages</li>
</ul>
</div>
<h2 id="conda">Conda<a class="headerlink" href="#conda" title="Anchor link to this section for reference">&para;</a></h2>
<ul>
<li>
<p><a href="https://anaconda.org/anaconda/conda">Conda</a> is an installer of packages but also bigger toolkits and is useful also for R packages and C/C++ installations.</p>
</li>
<li>
<p>Conda creates isolated environments not clashing with other installations of python and other versions of packages.</p>
</li>
<li>Conda environment requires that you install all packages needed by yourself. <ul>
<li>That is,  you cannot load the python module and use the packages therein inside you Conda environment.</li>
</ul>
</li>
</ul>
<details>
<summary>Conda channels</summary>
</details>
<ul>
<li>conda-forge</li>
<li>scilifelab-lts</li>
<li>r</li>
<li>main</li>
<li>bioconda</li>
<li>free</li>
<li>pro</li>
<li>qiime2</li>
<li>biocore</li>
<li>dranew</li>
<li>r2018.11</li>
<li>nvidia</li>
<li>pytorch</li>
<li>
<p>anaconda</p>
<p>You reach them all by loading the conda module. You don't have to state the specific channel when using UPPMAX. Otherwise you do with <code>conda -c &lt;channel&gt; ...</code></p>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Drawbacks</p>
<ul>
<li>Conda cannot use already install packages from the Python modules and libraries already installed, and hence installs them anyway</li>
<li>Conda is therefore known for creating <strong>many</strong> <em>small</em> files. Your diskspace is not only limited in GB, but also in number of files (typically <code>300000</code> in $HOME). </li>
<li>Check your disk usage and quota limit<ul>
<li>Do a <code>conda clean -a</code> once in a while to remove unused and unnecessary files</li>
</ul>
</li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li>The conda environemnts includes many small files are by default stored in <code>~/.conda</code> folder that is in your $HOME directory with limited storage.</li>
</ul>
<p>This works nicely if you have several projects. Then you can change these varables according to what you are currently working with.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CONDA_ENVS_PATH</span><span class="o">=</span><span class="s2">&quot;path/to/your/project/(subdir)&quot;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CONDA_PKG_DIRS</span><span class="o">=</span><span class="s2">&quot;path/to/your/project/(subdir)&quot;</span>
</code></pre></div>
</div>
<h3 id="typical-workflow_1">Typical workflow<a class="headerlink" href="#typical-workflow_1" title="Anchor link to this section for reference">&para;</a></h3>
<p>The first 2 steps are cluster dependent and will therefore be slightly different.</p>
<ol>
<li>
<p>Make conda available from a software module: <code>source /sw/apps/conda/latest/rackham_stage/etc/profile.d/conda.sh</code>, or use own installation of miniconda or miniforge.</p>
</li>
<li>
<p>First time</p>
</li>
</ol>
<details>
<summary>First time</summary>
<ul>
<li>The variables CONDA_ENVS_PATH and CONDA_PKG_DIRS contains the location of your environments. Set it to your project's environments folder, if you have one, instead of the $HOME folder.</li>
<li>Otherwise, the default is <code>~/.conda/envs</code>. </li>
<li>Example:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">CONDA_ENVS_PATH</span><span class="o">=</span><span class="s2">&quot;path/to/your/project/(subdir)&quot;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="gp">$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$CONDA_ENVS_PATH</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">CONDA_PKG_DIRS</span><span class="o">=</span><span class="s2">&quot;path/to/your/project/(subdir)&quot;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="gp">$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$CONDA_PKGS_DIRS</span>
</code></pre></div>
<ul>
<li>Disable the auto activation of the <code>(base)</code> environment<br />
<code>(base) conda config --set auto_activate_base false</code></li>
<li>Logout and login again!</li>
</ul>
</details>
<p>Next steps are the same for all clusters</p>
<ol>
<li>Create the conda environment <code>conda create -n &lt;name-of-env&gt;</code></li>
<li>
<p>Activate the conda environment by: <code>source activate &lt;conda-env-name&gt;</code></p>
<ul>
<li>You can define the packages to be installed here already.</li>
<li>If you want another Python version, you have to define it here, like: <code>conda ... python=3.6.8</code></li>
</ul>
</li>
<li>
<p>Install the packages with <code>conda install ...</code> or <code>pip install ...</code></p>
</li>
<li>
<p>Now do your work!</p>
<ul>
<li>When activated you can always continue to add packages!</li>
</ul>
</li>
<li>
<p>Deactivate</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="o">(</span>python-36-env<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>conda<span class="w"> </span>deactivate
</code></pre></div>
<details>
<summary>Comments</summary>
<ul>
<li>When pinning with Conda, use single <code>=</code> instead of double (as used by pip)</li>
</ul>
</details>
<details>
<summary>Conda base env</summary>
<ul>
<li>When conda is loaded you will by default be in the base environment, which works in the same way as other conda environments. It includes a Python installation and some core system libraries and dependencies of Conda. It is a "best practice" to avoid installing additional packages into your base software environment.</li>
</ul>
</details>
<details>
<summary>Conda cheat sheet</summary>
<ul>
<li>List packages in present environment: <code>conda list</code></li>
<li>List all environments:            <code>conda info -e</code> or <code>conda env list</code></li>
<li>Install a package: <code>conda install somepackage</code></li>
<li>Install from certain channel (conda-forge): <code>conda install -c conda-forge somepackage</code></li>
<li>Install a specific version: <code>conda install somepackage=1.2.3</code></li>
<li>Create a new environment: <code>conda create --name myenvironment</code></li>
<li>Create a new environment from requirements.txt: <code>conda create --name myenvironment --file requirements.txt</code></li>
<li>On e.g. HPC systems where you don't have write access to central installation directory: conda create --prefix /some/path/to/env`</li>
<li>Activate a specific environment: <code>conda activate myenvironment</code></li>
<li>Deactivate current environment: <code>conda deactivate</code></li>
</ul>
</details>
<details>
<summary>Conda vs mamba etc...</summary>
<ul>
<li><a href="https://pixi.sh/latest/misc/FAQ/#what-is-the-difference-with-conda-mamba-poetry-pip">what-is-the-difference-with-conda-mamba-poetry-pip</a></li>
</ul>
</details>
<details>
<summary>What to do when a problem arises?</summary>
<ul>
<li>If you experience unexpected problems with the conda provided by the module system on Rackham or anaconda3 on Dardel, you can easily install your own and maintain it yourself.</li>
<li>Read more at <a href="https://hackmd.io/@pmitev/conda_on_Rackham">Pavlin Mitev's page about conda on Rackham/Dardel</a> and change paths to relevant one for your system.</li>
<li>Or <a href="https://hackmd.io/@pmitev/module_conda_Rackham">Conda - "best practices" - UPPMAX</a></li>
</ul>
</details>
<h2 id="install-from-file">Install from file<a class="headerlink" href="#install-from-file" title="Anchor link to this section for reference">&para;</a></h2>
<h3 id="venv">venv<a class="headerlink" href="#venv" title="Anchor link to this section for reference">&para;</a></h3>
<p><code>pip install -r requirements.txt</code></p>
<h3 id="conda_1">conda<a class="headerlink" href="#conda_1" title="Anchor link to this section for reference">&para;</a></h3>
<p><code>conda env create -f environment.yaml</code></p>
<h2 id="exercises">Exercises<a class="headerlink" href="#exercises" title="Anchor link to this section for reference">&para;</a></h2>
<div class="admonition question">
<p class="admonition-title">Exercise 0: Make a decision between <code>venv</code> or <code>conda</code>.</p>
<ul>
<li>go with <code>venv</code> first as it is simpler to setup.</li>
<li>go with <code>conda</code> if you need many envs to manage.</li>
</ul>
</div>
<div class="admonition question">
<p class="admonition-title">Exercise 1: Cover the documentation for venvs or conda</p>
<p>First try to find it by navigating.</p>
<p><strong>For venv:</strong>
- <a href="https://docs.uppmax.uu.se/software/python_venv/">Python venv documentation at UPPMAX</a>
- <a href="https://www.youtube.com/watch?v=lj_Q-5l0BqU">Video Tutorial By Richel</a></p>
<p><strong>For conda:</strong>
- <a href="https://hackmd.io/@pmitev/module_conda_Rackham">Installing using available source file</a>
- <a href="https://hackmd.io/@pmitev/conda_on_Rackham">Your own conda installation</a>
- <a href="https://docs.uppmax.uu.se/software/conda/">Installing using available module</a></p>
</div>
<div class="admonition question">
<p class="admonition-title">Exercise 2: Prepare the course environment</p>
<p>install transformers torch torchvision notebook</p>
</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../slurm-intro/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Slurm">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Slurm
              </div>
            </div>
          </a>
        
        
          
          <a href="../jupyter/" class="md-footer__link md-footer__link--next" aria-label="Next: Jupyter Notebooks">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Jupyter Notebooks
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.path", "navigation.footer", "search.suggest", "content.code.annotate", "content.tabs.link"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>